# components_k8s

# Рекомендуемая конфигурация Kubernetes-кластера  
**Сбалансированный вариант с N+1 отказоустойчивостью**

## Общая потребность приложения (resource requests)

| Компонент       | Реплик | CPU   | RAM      | CPU всего | RAM всего   |
|-----------------|--------|-------|----------|-----------|-------------|
| База данных     | 3      | 1.0   | 4.0 GiB  | 3.0       | 12.0 GiB    |
| Кеш             | 3      | 1.0   | 4.0 GiB  | 3.0       | 12.0 GiB    |
| Backend         | 10     | 1.0   | 0.6 GiB  | 10.0      | 6.0 GiB     |
| Frontend        | 5      | 0.2   | 0.05 GiB | 1.0       | 0.25 GiB    |
| **Итого**       | **21** | —     | —        | **17.0**  | **30.25 GiB** |

## Выбранный тип worker-ноды

**Размер:** 8 vCPU / 32 GiB RAM  
(оптимальный и наиболее распространённый выбор по соотношению цена/производительность/надёжность)

**Реально доступно под поды (allocatable, после системных резервов и eviction):**
- CPU ≈ **7.6 core**  
- RAM ≈ **27 GiB**

## Расчёт количества нод с учётом N+1

После отказа любой одной ноды кластер должен полностью выдерживать нагрузку.

| Кол-во нод | CPU после отказа 1 ноды | Запас по CPU | RAM после отказа | Запас по RAM | Оценка                     |
|------------|--------------------------|--------------|------------------|--------------|----------------------------|
| 3          | 22.8 core                | +34%         | 81 GiB           | +168%        | минимально, риск при пиках |
| **4**      | **22.8 core**            | **+34%**     | **81 GiB**       | **+168%**    | **оптимальный баланс**     |
| 5          | 30.4 core                | +79%         | 108 GiB          | +257%        | избыточно, дороже          |

## Итоговый выбор

**4 worker-ноды × 8 vCPU / 32 GiB RAM**

### Ключевые показатели

- После отказа одной ноды остаётся ~75% мощности кластера  
- Запас по CPU: **+34%**  
- Запас по RAM: **+168%**  
- Общее allocatable: **~30.4 core CPU** / **~108 GiB RAM**

### Плюсы выбранного варианта

- комфортный запас ресурсов даже при отказе одной ноды  
- разумное количество нод → низкие накладные расходы  
- хорошее соотношение цена / производительность  
- удобно для stateful-компонентов (БД и кеш)  
- соответствует современным рекомендациям по размеру нод

**Рекомендуемый вариант:**  
**4 × (8 vCPU / 32 GiB)**
